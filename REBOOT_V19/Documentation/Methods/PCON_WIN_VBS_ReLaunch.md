ReLaunchApp()    Function ReLaunchApp()  	'※ VBScriptでは引数にダブルクォートが受け取れないため、必ず "<quot>" に置換して渡すこと    	Dim lcid  	lcid = GetLocale() ' [ 1041 : 日本 ] , [ 1033 : EN-US ]    	'↓ここからJSONパース    	Dim pathJson,strJson,html,objJson    	'引数取得  	If WScript.Arguments.Count >= 1 Then  		pathJson = WScript.Arguments(0)  		strJson = GetFileToText(pathJson)  	Else  		pathJson = ""  		strJson = ""  	End If    	'ダブルクォート復元  	strJson = Replace(strJson,"<quot>","""")    	'仮想HTMLオブジェクト生成  	Set html = Wscript.CreateObject("HtmlFile")    	'DOMにパース用Javascript構築  	html.write "<script>document.JsonParse=function (s) {return eval('(' + s + ')');}</script>"    	'JSONのパス実施  	Set objJson = html.JsonParse(strJson)    	'↑ここまでJSONパース    	'↓ここから配列要素専用処理  	Dim PATH_REMOVE,PATH_MOVE_F,PATH_MOVE_T  	PATH_REMOVE = Split(objJson.PATH_REMOVE,",")  	PATH_MOVE_F = Split(objJson.PATH_MOVE_F,",")  	PATH_MOVE_T = Split(objJson.PATH_MOVE_T,",")  	'↑ここまで配列要素専用処理    	'↓ここからプロセス終了待機    	Dim ExecLoop,ExecSleep,ExecCount,ExecLimit,Timedout  	Dim ProcessVisible,ProcessName    	ExecLoop = True  	ExecSleep = 250 '1ループあたりの待機時間 [ ミリ秒 ( = 1/1000秒 ) ]  	ExecCount = 0  	ExecLimit = 4 * 60 * 5 'ループ回数上限 ( 現状では概ね5分程度になるよう調整 )  '	ExecLimit = 30 'テスト用  	Timedout = False  	Do While ExecLoop = True  		ExecCount = ExecCount + 1  		ProcessName = ProcessSearch(objJson.ProcessID)  		ProcessVisible = (ProcessName <> "")  		If ProcessVisible = True Then  			WScript.Echo "Process '" & ProcessName & "' found. ( TRY : " & ExecCount & " )"  			If ExecCount >= ExecLimit Then  				WScript.Echo "Timed out to wait '" & ProcessName & "' to finish."  				ExecLoop = False  				Timedout = True  			Else  				WScript.Sleep ExecSleep  			End If  		Else  			WScript.Echo "Process not found. ( Detected process ID '" & objJson.ProcessID & "' is complete. )"  			ExecLoop = False  		End If  	Loop    	'↑ここからプロセス終了待機    	'↓ここからプロセス再起動  	Dim objShell    	If Timedout = True Then  		If lcid = 1041 Then  			Msgbox "タイムアウトによりアプリケーションの再起動に失敗しました。" & vbCrLf & "( 必要に応じて手動で再起動してください。)"  		Else  			Msgbox "Timed out to reboot this application." & vbCrLf & "( If necessary, please reboot it manually. )"  		End If  	Else    		'ファイル削除＆移動前のホールド解除用待機  		WScript.Sleep 500 'ミリ秒    		'指定ファイルの一括削除  		For i = LBound(PATH_REMOVE) To UBound(PATH_REMOVE)  '			Msgbox "REMOVE = """ & PATH_REMOVE(i) & """" 'デバッグ用  			RemoveFile(PATH_REMOVE(i))  		Next    		'指定ファイルの一括移動  		For i = LBound(PATH_MOVE_F) To UBound(PATH_MOVE_F)  '			Msgbox "FROM = """ & PATH_MOVE_F(i) & """" & vbCrLf & "TO = """ & PATH_MOVE_F(i) & """" 'デバッグ用  			ReplaceFile PATH_MOVE_F(i),PATH_MOVE_T(i)  		Next    		'ファイル削除＆移動の遅延待機  		WScript.Sleep 500 'ミリ秒    		'外部コマンド実行  	    Set objShell = WScript.CreateObject("WScript.Shell")  '	    Msgbox objJson.bootCommand 'デバッグ用      	objShell.Run objJson.bootCommand  	    Set objShell = Nothing    	End If  	'↑ここからプロセス再起動    	CleanScript()    End Function    'プロセス検索汎用  Function ProcessSearch(ProcessNumber)      Dim Service,QfeSet,Qfe,ProcessName,TargetVisible      Set Service = WScript.CreateObject("WbemScripting.SWbemLocator").ConnectServer      Set QfeSet = Service.ExecQuery("Select * From Win32_Process Where ProcessId = " & ProcessNumber)      ProcessName = ""  	TargetVisible = False      For Each Qfe In QfeSet          ProcessName = Qfe.Caption          TargetVisible = True          Exit For      Next      ProcessSearch = ProcessName  End Function    '標準入力取得  Function GetStdIn()  	Dim CurrentStream  	CurrentStream = ""  	Do While Wscript.StdIn.AtEndOfStream = False  		CurrentStream = CurrentStream & Wscript.StdIn.ReadLine  	Loop  	GetStdIn = CurrentStream  End Function    'ファイル取得  Function GetFileToText(filepath)  	Dim objFSO 'FileSystemObject  	Dim objFile 'ファイル読み込み用  	Dim CurrentStream  	CurrentStream = ""  	Set objFSO = WScript.CreateObject("Scripting.FileSystemObject")  	If Err.Number = 0 Then  		Set objFile = objFSO.OpenTextFile(filepath)  		If Err.Number = 0 Then  			Do While objFile.AtEndOfStream <> True  				CurrentStream = CurrentStream & objFile.ReadLine  			Loop  			objFile.Close  		Else  '			WScript.Echo "ファイルオープンエラー: " & Err.Description  			Msgbox "ファイルオープンエラー: " & Err.Description  		End If  	Else  '		WScript.Echo "エラー: " & Err.Description  		Msgbox "エラー: " & Err.Description  	End If    	Set objFile = Nothing  	Set objFSO = Nothing    	GetFileToText = CurrentStream  End Function    'ファイル一括削除  Function CleanScript()  	Dim jsonPath,scriptCaller,scriptRelaunch  	scriptRelaunch = Wscript.scriptfullname  	scriptCaller = Replace(scriptRelaunch,"_relaunch.vbs","_caller.vbs")  	jsonPath = Replace(scriptRelaunch,"_relaunch.vbs","_json.txt")  '	Msgbox "scriptCaller = """ & scriptCaller & """" & vbCrLf & "scriptRelaunch = """ & scriptRelaunch & """" & vbCrLf & "jsonPath = """ & jsonPath & """" 'デバッグ用  	RemoveFile(scriptRelaunch)  	RemoveFile(scriptCaller)  	RemoveFile(jsonPath)  End Function    'ファイル削除汎用  Function RemoveFile(filepath)  	Dim objFSO 'FileSystemObject  	Set objFSO = WScript.CreateObject("Scripting.FileSystemObject")  	If objFSO.FileExists(filepath) Then  		If Err.Number = 0 Then  			objFSO.DeleteFile filepath, True  			If Err.Number = 0 Then  	'			WScript.Echo filepath & " を削除しました。"  			Else  '				WScript.Echo "エラー: " & Err.Description  			End If  		Else  '			WScript.Echo "エラー: " & Err.Description  		End If  	End If  	Set objFSO = Nothing  End Function    'ファイル移動汎用  Function ReplaceFile(pathFrom,pathTo)  	Dim objFSO 'FileSystemObject  	Dim movable  	Set objFSO = WScript.CreateObject("Scripting.FileSystemObject")    	movable = True    	If objFSO.FileExists(pathFrom) Then  		'OK  	Else  		'NG  		movable = False  	End If    	If movable = True Then  		If objFSO.FileExists(pathTo) Then  			If Err.Number = 0 Then  				objFSO.DeleteFile pathTo, True  				If Err.Number = 0 Then  '					WScript.Echo filepath & " を削除しました。"  					movable = True  				Else  '					WScript.Echo "エラー: " & Err.Description  					movable = False  				End If  			Else  '				WScript.Echo "エラー: " & Err.Description  				movable = False  			End If  		Else  			movable = True  		End If  	End If    	If movable = True Then  		objFSO.MoveFile pathFrom,pathTo  	End If    	Set objFSO = Nothing    End Function