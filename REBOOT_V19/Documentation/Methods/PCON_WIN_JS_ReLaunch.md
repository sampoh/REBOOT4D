reLaunchApp();    function reLaunchApp(){    	var pathJson = '';  	var strJson = '';  	var objJson = {};    	if(WScript.Arguments.length >= 1){  		pathJson = WScript.Arguments(0);  		strJson = getFileToText(pathJson);  		objJson = eval("(" + strJson + ")");  	}    	//↓ここからプロセス終了待機  	var processVisible = false;  	var processName = '';  	var exec = {  		"loop":true,  		"sleep":250, //1ループあたりの待機時間 [ ミリ秒 ( = 1/1000秒 ) ]  		"count":0,  		"limit":(4 * 60 * 5), //ループ回数上限 ( 現状では概ね5分程度になるよう調整 )  //		"limit":30, //テスト用  		"timedout":false  	};  	while(exec.loop){  		exec.count = exec.count + 1;  		processName = processSearch(objJson.ProcessID);  		processVisible = (processName != '');  		if(processVisible){  			WScript.Echo("Process '" + processName + "' found. ( TRY : " + exec.count + " )");  			if(exec.count >= exec.limit){  				WScript.Echo("Timed out to wait '" + processName + "' to finish.");  				exec.loop = false;  				exec.timedout = true;  			}else{  				WScript.Sleep(exec.sleep);  			}  		}else{  			WScript.Echo("Process not found. ( Detected process ID '" + objJson.ProcessID + "' is complete. )");  			exec.loop = false;  		}  	}  	//↑ここまでプロセス終了待機    	//↓ここからプロセス再起動  	var objShell = new ActiveXObject("WScript.Shell");    	if(exec.timedout){  		var title = "エラー";  //		var title = "Error";  		var msg = "タイムアウトによりアプリケーションの再起動に失敗しました。\r\n( 必要に応じて手動で再起動してください。)";  //		var msg = "Timed out to reboot this application.\r\n( If necessary, please reboot it manually. )";  		objShell.Popup(msg,0,title,1);  	}else{    		//ファイル削除＆移動前のホールド解除用待機  		WScript.Sleep(500); //ミリ秒    		//指定ファイルの一括削除  		for(var i=0;i < objJson.PATH_REMOVE.length;i++){  			removeFile(objJson.PATH_REMOVE[i]);  		}    		//指定ファイルの一括移動  		for(var i=0;i < objJson.PATH_MOVE_F.length;i++){  			replaceFile(objJson.PATH_MOVE_F[i],objJson.PATH_MOVE_T[i]);  		}    		//ファイル削除＆移動の遅延待機  		WScript.Sleep(500); //ミリ秒    		//外部コマンド実行  //		objShell.Popup(objJson.bootCommand,0,'',1); //デバッグ用  		objShell.Run(objJson.bootCommand);  		objShell = null;    	}  	//↑ここまでプロセス再起動    	cleanScript();    }    //プロセス検索汎用  function processSearch(processNumber){  	var processName = '';  	var queryResult = [];  	var locator = new ActiveXObject("WbemScripting.SWbemLocator");  	var services = locator.ConnectServer(null, "root\\CIMV2");  	var set = services.ExecQuery("Select * From Win32_Process Where ProcessId = " + processNumber);  	var enumSet = new Enumerator(set);  	while(!enumSet.atEnd()){  		queryResult.push(enumSet.item());  		enumSet.moveNext();  	}      for(var i=0;i < queryResult.length;i++){  	    processName = queryResult[i].Caption;      }      return processName  }    //ファイル取得  function getFileToText(filepath){    	//  オープンモード  	var FORREADING      = 1;    // 読み取り専用  	var FORWRITING      = 2;    // 書き込み専用  	var FORAPPENDING    = 8;    // 追加書き込み    	//  開くファイルの形式  	var TRISTATE_TRUE       = -1;   // Unicode  	var TRISTATE_FALSE      =  0;   // ASCII  	var TRISTATE_USEDEFAULT = -2;   // システムデフォルト    	//  ファイル関連の操作を提供するオブジェクトを取得  	var fs = new ActiveXObject( "Scripting.FileSystemObject" );    	//  ファイルを読み取り専用で開く  	var file = fs.OpenTextFile( filepath, FORREADING, true, TRISTATE_FALSE );    	//  ファイルから全ての文字データを読み込む  	var str = file.ReadAll();    	return str;    }    //ファイル一括削除  function cleanScript(){  	var scriptRelaunch = WScript.scriptfullname;  	var scriptCaller = scriptRelaunch.replace("_relaunch.js","_caller.js");  	var jsonPath = scriptRelaunch.replace("_relaunch.js","_json.txt");  	removeFile(scriptRelaunch);  	removeFile(scriptCaller);  	removeFile(jsonPath);  }    //ファイル削除汎用  function removeFile(filepath){  	var fs = new ActiveXObject("Scripting.FileSystemObject");  	if(fs.FileExists(filepath)){ fs.DeleteFile(filepath,true); } //読み取り専用ファイルでも削除  	fs = null;  }      //ファイル移動汎用  function replaceFile(pathFrom,pathTo){  	var fs = new ActiveXObject("Scripting.FileSystemObject");  	var movable = (fs.FileExists(pathFrom));  	if(movable){  		if(fs.FileExists(pathTo)){  			fs.DeleteFile(pathTo,true);  			movable = !(fs.FileExists(pathTo));  		}else{  			movable = true;  		}  	}  	if(movable){ fs.MoveFile(pathFrom,pathTo); }  	fs = null;  }