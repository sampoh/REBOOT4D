app = Application.currentApplication();  app.includeStandardAdditions = true;    fm = $.NSFileManager.defaultManager;    function timer (repeats, func, delay) {      var args = Array.prototype.slice.call(arguments, 2, -1);      args.unshift(this);      var boundFunc = func.bind.apply(func, args);      var operation = $.NSBlockOperation.blockOperationWithBlock(boundFunc);      var timer = $.NSTimer.timerWithTimeIntervalTargetSelectorUserInfoRepeats(          delay / 1000, operation, 'main', null, repeats      );      $.NSRunLoop.currentRunLoop.addTimerForMode(timer, "timer");      return timer;  }    function invalidate(timeoutID) {    timeoutID.invalidate  }    var setTimeout = timer.bind(undefined, false)  var setInterval = timer.bind(undefined, true)  var clearTimeout = invalidate  var clearInterval = invalidate    function wait4D(inputObj){      var hit = false;      var loopMin = 5;      var loopSec = loopMin * 60;  //    var loopSec = 50;      var loopLimit = loopSec * 4;      var loopCount = 0;      var execute = false;      var timerID = setInterval(function(){            hit = false;          loopCount++;  //        var psList = app.doShellScript("ps axo pid,command");  //        ↓文字コード指定追加 - 2019/10/30 Y.Takahara          var psList = app.doShellScript('bash -c "export LANG=ja_JP.UTF-8;ps axo pid,command"');          psList.replace(/\r?\n/g,"\n");          var psArr = psList.split(/\r\n|\r|\n/);            for(var i=0;i < psArr.length;i++){              var line = psArr[i].replace(/^[\s\t]+|[\s\t]+$/g,'');              var matchObj = line.match(/^([0-9]+)\s+(.*?)$/);              if(matchObj){                  if(matchObj.length >= 3){                      if(inputObj.ProcessID == Number(matchObj[1])){                          if( matchObj[2].substr(0,inputObj.application.length) == inputObj.application ){                              hit = true;                              console.log("< HIT > " + loopCount + " : " + matchObj[1] + ' = "' + matchObj[2] + '"');                          }                      }                  }              }          }            if(!hit || (loopCount >= loopLimit)){              clearInterval(timerID);              timerID = null;              execute = !hit;              if(execute){                  fileControl(inputObj);                  console.log("executable");                  app.displayNotification('Rebooting application now ...',{'withTitle':'REBOOT'});                  app.doShellScript(inputObj.bootCommand);              }else{                  console.log("not executable");                  app.displayNotification('Failed to reboot the application.',{'withTitle':'REBOOT'});              }          }        },250);  }    function run(arguments){      var argArr = [];      arguments.forEach(function(arg,idx){          argArr.push(arg);      });      for(var i=0;i < argArr.length;i++){          console.log(argArr[i]);      }      var execute = (argArr.length >= 1);      if(execute){          execute = fm.fileExistsAtPath(argArr[0]);      }      if(execute){          jsonStr = readFrom(argArr[0]);          jsonObj = JSON.parse(jsonStr);          wait4D(jsonObj);          $.NSRunLoop.currentRunLoop.runModeBeforeDate("timer", $.NSDate.distantFuture);  /*          console.log(jsonObj.bootCommand);          var psList = app.doShellScript("ps axo pid,command");          app.displayNotification(psList,{             'withTitle':'test title',             'subtitle':'test sub title',  //           'soundName':'Glass'           });  */      }  }    function readFrom(path, encoding) {      var p = $(path).stringByStandardizingPath;      var u = encoding || $.NSUTF8StringEncoding;      var e = $();      var c = $.NSString.stringWithContentsOfFileEncodingError(p, u, e).js;      if (e.js) {          throw new Error($.NSString.stringWithFormat("%@", e).js);      }      return c;  }    function writeTo(contents, path, encoding) {      var p = $(path).stringByStandardizingPath      var a = $(true)      var u = encoding || $.NSUTF8StringEncoding      var e = $()      $(contents).writeToFileAtomicallyEncodingError(p, a, u, e)      if (e.js) {          throw new Error($.NSString.stringWithFormat("%@", e).js)      }  }    function append(contents, path, encoding) {      if ($.NSFileManager.defaultManager.fileExistsAtPath($(path).stringByStandardizingPath)) {          var c = readFrom(path, encoding)      } else {          var c = ""      }      writeTo(c + contents, path, encoding)  }    function fileControl(inputObj){      for(var i=0;i < inputObj.PATH_REMOVE.length;i++){          removeFile(inputObj.PATH_REMOVE[i]);      }      for(var i=0;i < inputObj.PATH_MOVE_F.length;i++){          moveFile(inputObj.PATH_MOVE_F[i],inputObj.PATH_MOVE_T[i]);      }  }    function removeFile(FILEPATH){      if(fm.fileExistsAtPath(FILEPATH)){          app.doShellScript('rm -rf "' + FILEPATH + '"');      }  }    function moveFile(FILEPATH_FROM,FILEPATH_TO){      if(fm.fileExistsAtPath(FILEPATH_FROM)){          if(fm.fileExistsAtPath(FILEPATH_TO)){              app.doShellScript('rm -rf "' + FILEPATH_TO + '"');          }          app.doShellScript('mv "' + FILEPATH_FROM + '" "' + FILEPATH_TO +'"');      }  }